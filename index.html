<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Herramienta de Generación de Indicaciones Legales con IA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .indications-output {
            white-space: pre-wrap;
            line-height: 1.6;
        }
        .loader {
            border: 4px solid #f3f3f3; /* Light grey */
            border-top: 4px solid #3498db; /* Blue */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">Herramienta de Generación de Indicaciones Legales con IA</h1>
            <p class="text-gray-600 mt-2">Genere indicaciones de modificación comparando un texto original y uno final usando Gemini.</p>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Column 1: Original Text -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold mb-4 border-b pb-2">Texto Original</h2>
                <textarea id="originalText" class="w-full h-96 p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" placeholder="Pegue aquí el texto original aprobado..."></textarea>
            </div>

            <!-- Column 2: Final Text -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold mb-4 border-b pb-2">Texto Final</h2>
                <textarea id="finalText" class="w-full h-96 p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" placeholder="Pegue aquí el texto final modificado..."></textarea>
            </div>

            <!-- Column 3: Generated Indications -->
            <div class="bg-white p-6 rounded-lg shadow-md flex flex-col">
                <h2 class="text-xl font-semibold mb-4 border-b pb-2">Propuesta Indicaciones (Generado por IA)</h2>
                <div id="indicationsResult" class="w-full flex-grow p-3 border border-gray-200 rounded-md bg-gray-50 overflow-y-auto indications-output">
                    Aquí aparecerán sus indicaciones generadas.
                </div>
            </div>
        </div>

        <div class="text-center mt-8">
            <button id="generateButton" onclick="generateIndications()" class="bg-green-600 text-white font-bold py-3 px-8 rounded-lg shadow-lg hover:bg-green-700 focus:outline-none focus:ring-4 focus:ring-green-300 transition-transform transform hover:scale-105 disabled:bg-gray-400 disabled:cursor-not-allowed">
                Generar Indicaciones
            </button>
        </div>
    </div>

    <script>
        // Pre-fill textareas with example text for demonstration
        document.addEventListener('DOMContentLoaded', (event) => {
            document.getElementById('originalText').value = `Artículo 6.- Costos financieros. El Saldo Final Restante considerará una tasa anual de reajuste que deberá ser aprobada por el Ministerio de Hacienda. Podrá ser fijada en dólares de los Estados Unidos de América, y no podrá exceder la Tasa de Política Monetaria vigente publicada por el Banco Central de Chile, más 25 puntos base. Dicha tasa podrá ser ajustada por el Ministerio de Hacienda, de acuerdo con las condiciones de mercado vigentes al momento de la emisión del documento de pago a que se refiere el artículo 8.`;
            document.getElementById('finalText').value = `Artículo 6.- Costos financieros. El Saldo Final Restante considerará una tasa anual de reajuste que deberá ser aprobada por el Ministerio de Hacienda. Podrá ser fijada en dólares de los Estados Unidos de América, y corresponderá a la Tasa de Política Monetaria vigente publicada por el Banco Central de Chile, más 25 puntos base. Dicha tasa deberá ser ajustada por el Ministerio de Hacienda, de acuerdo con las condiciones de mercado vigentes al momento de la emisión del documento de pago a que se refiere el artículo 8.`;
        });

        /**
         * Calls our secure backend function to generate legal indications.
         */
        async function generateIndications() {
            const originalText = document.getElementById('originalText').value;
            const finalText = document.getElementById('finalText').value;
            const outputDiv = document.getElementById('indicationsResult');
            const generateButton = document.getElementById('generateButton');

            if (!originalText || !finalText) {
                outputDiv.textContent = 'Por favor, ingrese tanto el texto original como el final.';
                return;
            }

            // --- UI: Show loading state ---
            generateButton.disabled = true;
            generateButton.textContent = 'Generando...';
            outputDiv.innerHTML = '<div class="loader"></div>';

            // The URL for our new backend function.
            // This path is automatically handled by Netlify.
            const functionUrl = '/.netlify/functions/generate-indications';

            try {
                const response = await fetch(functionUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ originalText, finalText })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `La solicitud falló con el estado ${response.status}`);
                }

                const result = await response.json();
                outputDiv.innerHTML = result.text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

            } catch (error) {
                console.error('Error al llamar a la función de backend:', error);
                outputDiv.textContent = `Ocurrió un error al generar las indicaciones. Por favor, inténtelo de nuevo. Detalles: ${error.message}`;
            } finally {
                // --- UI: Restore original state ---
                generateButton.disabled = false;
                generateButton.textContent = 'Generar Indicaciones';
            }
        }
    </script>

</body>
</html>
